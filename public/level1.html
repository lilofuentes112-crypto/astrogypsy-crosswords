<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <title>Zertifikats-Kreuzworträtsel – Level 1</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
        sans-serif;
      background: #000;
      color: #f5e0c0;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      min-height: 100vh;
    }

    .cw-wrapper {
      position: relative;
      width: 100%;
      max-width: 600px;
      margin: 24px auto;
      padding: 0 8px;
    }

    .cw-background {
      position: fixed;
      inset: 0;
      background-size: cover;
      background-position: center;
      opacity: 0.65;
      z-index: 0;
    }

    .cw-content {
      position: relative;
      z-index: 1;
      background: rgba(0, 0, 0, 0.55);
      border: 1px solid #8c5b2f;
      border-radius: 8px;
      padding: 16px 16px 20px;
      backdrop-filter: blur(2px);
    }

    h1 {
      margin: 0 0 12px;
      font-size: 20px;
      text-align: center;
    }

    .direction-toggle {
      display: flex;
      justify-content: center;
      gap: 8px;
      margin-bottom: 10px;
    }

    .direction-toggle button {
      border: 1px solid #8c5b2f;
      background: rgba(0, 0, 0, 0.7);
      color: #f5e0c0;
      padding: 4px 10px;
      border-radius: 4px;
      font-size: 13px;
      cursor: pointer;
    }

    .direction-toggle button.active {
      background: #8c5b2f;
      color: #110b06;
      font-weight: 600;
    }

    .grid {
      margin: 0 auto 10px;
      border: 2px solid #8c5b2f;
      padding: 4px;
      display: inline-block;
      background: transparent;
    }

    .grid-row {
      display: flex;
    }

    .grid-cell {
      position: relative;
      width: 28px;
      height: 28px;
      /* standardmäßig UNSICHTBAR */
      border: none;
      background: transparent;
    }

    /* Nur aktive Felder sichtbar machen */
    .grid-cell.active {
      border: 1px solid #8c5b2f;
      background: rgba(0, 0, 0, 0.45);
    }

    .grid-cell input {
      width: 100%;
      height: 100%;
      border: none;
      outline: none;
      background: transparent;
      color: #f5e0c0;
      text-transform: uppercase;
      text-align: center;
      font-size: 16px;
      font-weight: 600;
      padding: 0;
    }

    /* Inaktive Felder: Eingabe deaktivieren und unsichtbar machen */
    .grid-cell:not(.active) input {
      opacity: 0;
      pointer-events: none;
    }

    .grid-cell input::placeholder {
      color: rgba(245, 224, 192, 0.4);
    }

    .grid-cell.wrong input {
      color: #ff6b6b;
    }

    .cell-number {
      position: absolute;
      top: 1px;
      left: 2px;
      font-size: 8px;
      color: #f5e0c0;
      opacity: 0.9;
      pointer-events: none;
    }

    .controls {
      display: flex;
      justify-content: center;
      gap: 8px;
      margin-bottom: 6px;
    }

    .controls button {
      border: 1px solid #8c5b2f;
      background: #8c5b2f;
      color: #110b06;
      padding: 4px 12px;
      border-radius: 4px;
      font-size: 13px;
      cursor: pointer;
    }

    .controls button.secondary {
      background: transparent;
      color: #f5e0c0;
    }

    .feedback {
      text-align: center;
      font-size: 12px;
      margin-bottom: 8px;
      min-height: 18px;
    }

    .feedback.error {
      color: #ffb3b3;
    }

    .feedback.success {
      color: #b6ffb3;
    }

    .clue-section {
      margin-top: 4px;
      font-size: 13px;
    }

    .clue-section h2 {
      font-size: 14px;
      margin: 4px 0;
    }

    .clue-list {
      list-style: none;
      padding-left: 0;
      margin: 0 0 4px;
    }

    .clue-list li {
      margin-bottom: 2px;
    }

    .clue-number {
      font-weight: 600;
      margin-right: 4px;
    }

    @media (max-width: 480px) {
      .grid-cell {
        width: 22px;
        height: 22px;
      }

      .grid {
        padding: 3px;
      }

      .cw-content {
        padding: 12px;
      }

      h1 {
        font-size: 18px;
      }
    }
  </style>
</head>
<body>
  <div class="cw-background" id="cw-bg"></div>

  <div class="cw-wrapper">
    <div class="cw-content">
      <h1>Zertifikats-Kreuzworträtsel – Level 1</h1>

      <div class="direction-toggle">
        <button type="button" data-direction="across" class="active">
          Waagrecht
        </button>
        <button type="button" data-direction="down">
          Senkrecht
        </button>
      </div>

      <div id="cw-grid" class="grid"></div>

      <div class="controls">
        <button id="check-btn">Lösung prüfen</button>
        <button id="clear-btn" class="secondary">Alles löschen</button>
      </div>

      <div id="feedback" class="feedback"></div>

      <div class="clue-section">
        <h2>Waagrecht</h2>
        <ul id="across-clues" class="clue-list"></ul>
      </div>

      <div class="clue-section">
        <h2>Senkrecht</h2>
        <ul id="down-clues" class="clue-list"></ul>
      </div>
    </div>
  </div>

  <script>
    // HINTERGRUNDBILD (Wix-URL)
    const BACKGROUND_IMAGE_URL =
      "https://static.wixstatic.com/media/6d3632_8671621dade74457977217105254aadf~mv2.png";

    // Raster-Größe (kannst du anpassen)
    const GRID_ROWS = 15;
    const GRID_COLS = 15;

    // Rätsel-Wörter – Positionen kannst du später nach Bedarf ändern
    const WORDS = [
      {
        id: "1-across",
        row: 7,
        col: 2,
        direction: "across",
        answer: "ASTROLOGIE",
        clueNumber: "1",
        clueText:
          "Lehre von den Zusammenhängen zwischen Gestirnen und irdischen Ereignissen.",
      },
      {
        id: "2-down",
        row: 3,
        col: 9,
        direction: "down",
        answer: "CHIRON",
        clueNumber: "2",
        clueText: "Planetoid, der oft mit Wunde und Heilung verbunden wird.",
      },
      {
        id: "3-down",
        row: 7,
        col: 3,
        direction: "down",
        answer: "ASPEKT",
        clueNumber: "3",
        clueText: "Winkelbeziehung zwischen zwei Planeten.",
      },
      {
        id: "4-down",
        row: 2,
        col: 10,
        direction: "down",
        answer: "ZODIAK",
        clueNumber: "4",
        clueText: "Worin stehen die Sternbilder in der Nacht?",
      },
    ];

    const SUCCESS_MESSAGE =
      "Gratuliere! Du hast Level 1 geschafft. Merke dir das Lösungswort, denn es ist dein Passwort für Level 2.";
    const ERROR_MESSAGE =
      "Es sind noch Fehler oder leere Felder vorhanden.";

    // --------------------------------------------------
    // Grundaufbau
    // --------------------------------------------------
    const gridEl = document.getElementById("cw-grid");
    const feedbackEl = document.getElementById("feedback");
    const checkBtn = document.getElementById("check-btn");
    const clearBtn = document.getElementById("clear-btn");
    const acrossList = document.getElementById("across-clues");
    const downList = document.getElementById("down-clues");
    const directionButtons = document.querySelectorAll(
      ".direction-toggle button"
    );

    let activeDirection = "across";
    let cellMap = {}; // key: "r-c" -> { cell, input, letters: {wordId: {word, index}}, numberEl }

    if (BACKGROUND_IMAGE_URL) {
      document.getElementById("cw-bg").style.backgroundImage =
        `url("${BACKGROUND_IMAGE_URL}")`;
    }

    directionButtons.forEach((btn) => {
      btn.addEventListener("click", () => {
        activeDirection = btn.dataset.direction;
        updateDirectionButtons();
      });
    });

    function updateDirectionButtons() {
      directionButtons.forEach((btn) => {
        if (btn.dataset.direction === activeDirection) {
          btn.classList.add("active");
        } else {
          btn.classList.remove("active");
        }
      });
    }

    // --------------------------------------------------
    // Grid erzeugen
    // --------------------------------------------------
    function createEmptyGrid() {
      for (let r = 0; r < GRID_ROWS; r++) {
        const rowEl = document.createElement("div");
        rowEl.className = "grid-row";

        for (let c = 0; c < GRID_COLS; c++) {
          const cell = document.createElement("div");
          cell.className = "grid-cell";
          cell.dataset.row = r;
          cell.dataset.col = c;

          const input = document.createElement("input");
          input.type = "text";
          input.maxLength = 1;
          input.autocomplete = "off";
          input.spellcheck = false;
          input.inputMode = "latin";

          input.addEventListener("input", handleInput);
          input.addEventListener("keydown", handleKeyDown);
          cell.addEventListener("click", () => handleCellClick(r, c));

          cell.appendChild(input);
          rowEl.appendChild(cell);

          cellMap[`${r}-${c}`] = {
            cell,
            input,
            letters: {},
            numberEl: null,
          };
        }

        gridEl.appendChild(rowEl);
      }
    }

    function placeWords() {
      for (const word of WORDS) {
        const upper = word.answer.toUpperCase();
        const len = upper.length;

        for (let i = 0; i < len; i++) {
          const r =
            word.row + (word.direction === "down" ? i : 0);
          const c =
            word.col + (word.direction === "across" ? i : 0);

          const key = `${r}-${c}`;
          const cellObj = cellMap[key];
          if (!cellObj) continue;

          cellObj.cell.classList.add("active");
          cellObj.letters[word.id] = {
            word,
            index: i,
          };

          // Nummern in die erste Zelle des Wortes
          if (i === 0) {
            if (!cellObj.numberEl) {
              const numSpan = document.createElement("span");
              numSpan.className = "cell-number";
              numSpan.textContent = word.clueNumber;
              cellObj.cell.appendChild(numSpan);
              cellObj.numberEl = numSpan;
            } else {
              // z.B. "1/3"
              cellObj.numberEl.textContent += "/" + word.clueNumber;
            }
          }
        }

        // Clues-Liste füllen
        const li = document.createElement("li");
        li.innerHTML =
          `<span class="clue-number">${word.clueNumber}.</span> ${word.clueText}`;
        if (word.direction === "across") {
          acrossList.appendChild(li);
        } else {
          downList.appendChild(li);
        }
      }
    }

    // --------------------------------------------------
    // Navigation / Eingabe
    // --------------------------------------------------
    function getCellObj(r, c) {
      return cellMap[`${r}-${c}`] || null;
    }

    function handleCellClick(row, col) {
      const cellObj = getCellObj(row, col);
      if (!cellObj || !Object.keys(cellObj.letters).length) return;

      // Falls Zelle zu einem Wort in der aktuellen Richtung gehört, dort bleiben
      const wordForCurrentDir = getWordEntryForDirection(
        cellObj,
        activeDirection
      );
      // Falls nicht, Richtung wechseln, wenn möglich
      if (!wordForCurrentDir) {
        const altDir =
          activeDirection === "across" ? "down" : "across";
        const wordAlt = getWordEntryForDirection(cellObj, altDir);
        if (wordAlt) {
          activeDirection = altDir;
          updateDirectionButtons();
        }
      }

      cellObj.input.focus();
      cellObj.input.select();
    }

    function getWordEntryForDirection(cellObj, dir) {
      for (const id in cellObj.letters) {
        if (cellObj.letters[id].word.direction === dir) {
          return cellObj.letters[id];
        }
      }
      return null;
    }

    function handleInput(e) {
      const input = e.target;
      let value = input.value.toUpperCase();
      input.value = value.slice(-1); // nur letzter Buchstabe

      const cell = input.parentElement;
      const r = parseInt(cell.dataset.row, 10);
      const c = parseInt(cell.dataset.col, 10);
      const cellObj = getCellObj(r, c);
      if (!cellObj) return;

      // Fehlermarkierung beim Tippen entfernen
      cellObj.cell.classList.remove("wrong");
      feedbackEl.textContent = "";
      feedbackEl.className = "feedback";

      const entry = getWordEntryForDirection(cellObj, activeDirection)
        || Object.values(cellObj.letters)[0];

      if (!entry) return;

      const word = entry.word;
      const nextIndex = entry.index + 1;
      if (nextIndex >= word.answer.length) return;

      const nextRow =
        word.row + (word.direction === "down" ? nextIndex : 0);
      const nextCol =
        word.col + (word.direction === "across" ? nextIndex : 0);
      const nextCellObj = getCellObj(nextRow, nextCol);
      if (nextCellObj) {
        nextCellObj.input.focus();
        nextCellObj.input.select();
      }
    }

    function handleKeyDown(e) {
      const input = e.target;
      const cell = input.parentElement;
      const r = parseInt(cell.dataset.row, 10);
      const c = parseInt(cell.dataset.col, 10);

      const cellObj = getCellObj(r, c);
      if (!cellObj) return;

      if (e.key === "Backspace" && !input.value) {
        // zum vorherigen Buchstaben im aktuellen Wort springen
        const entry =
          getWordEntryForDirection(cellObj, activeDirection) ||
          Object.values(cellObj.letters)[0];
        if (!entry) return;

        if (entry.index === 0) return;

        const prevIndex = entry.index - 1;
        const prevRow =
          entry.word.row +
          (entry.word.direction === "down" ? prevIndex : 0);
        const prevCol =
          entry.word.col +
          (entry.word.direction === "across" ? prevIndex : 0);
        const prevCellObj = getCellObj(prevRow, prevCol);
        if (prevCellObj) {
          e.preventDefault();
          prevCellObj.input.focus();
          prevCellObj.input.select();
        }
      }

      // Pfeiltasten: physische Bewegung
      let targetRow = r;
      let targetCol = c;
      let move = false;

      if (e.key === "ArrowRight") {
        targetCol++;
        move = true;
      } else if (e.key === "ArrowLeft") {
        targetCol--;
        move = true;
      } else if (e.key === "ArrowUp") {
        targetRow--;
        move = true;
      } else if (e.key === "ArrowDown") {
        targetRow++;
        move = true;
      }

      if (move) {
        e.preventDefault();
        const targetCellObj = getCellObj(targetRow, targetCol);
        if (targetCellObj && targetCellObj.cell.classList.contains("active")) {
          targetCellObj.input.focus();
          targetCellObj.input.select();
        }
      }
    }

    // --------------------------------------------------
    // Prüfung & Reset
    // --------------------------------------------------
    function clearGrid() {
      for (const key in cellMap) {
        const obj = cellMap[key];
        obj.input.value = "";
        obj.cell.classList.remove("wrong");
      }
      feedbackEl.textContent = "";
      feedbackEl.className = "feedback";
    }

    function checkSolution() {
      let allFilled = true;
      let allCorrect = true;

      // alte Fehler-Markierungen entfernen
      for (const key in cellMap) {
        cellMap[key].cell.classList.remove("wrong");
      }

      for (const word of WORDS) {
        const upper = word.answer.toUpperCase();
        const len = upper.length;

        for (let i = 0; i < len; i++) {
          const r =
            word.row + (word.direction === "down" ? i : 0);
          const c =
            word.col + (word.direction === "across" ? i : 0);
          const cellObj = getCellObj(r, c);
          if (!cellObj) continue;

          const val = (cellObj.input.value || "").toUpperCase();
          if (!val) {
            allFilled = false;
            allCorrect = false;
            cellObj.cell.classList.add("wrong");
          } else if (val !== upper[i]) {
            allCorrect = false;
            cellObj.cell.classList.add("wrong");
          }
        }
      }

      if (allCorrect && allFilled) {
        feedbackEl.textContent = SUCCESS_MESSAGE;
        feedbackEl.className = "feedback success";
      } else {
        feedbackEl.textContent = ERROR_MESSAGE;
        feedbackEl.className = "feedback error";
      }
    }

    checkBtn.addEventListener("click", checkSolution);
    clearBtn.addEventListener("click", clearGrid);

    // Start
    createEmptyGrid();
    placeWords();
  </script>
</body>
</html>

