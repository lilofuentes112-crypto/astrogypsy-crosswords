<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <title>Zertifikats-Kreuzworträtsel – Level 1</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #000;
      color: #f5be80;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      min-height: 100vh;
    }

    .cw-wrapper {
      margin: 24px;
      border: 2px solid #c47b3a;
      padding: 16px 16px 24px;
      max-width: 640px;
      width: 100%;
      background: #000;
    }

    .cw-title {
      text-align: center;
      font-size: 20px;
      margin-bottom: 12px;
    }

    .cw-mode-toggle {
      display: flex;
      justify-content: center;
      gap: 8px;
      margin-bottom: 8px;
    }

    .cw-mode-button {
      border: 1px solid #c47b3a;
      background: #000;
      color: #f5be80;
      padding: 4px 12px;
      cursor: default;
      font-size: 12px;
      border-radius: 3px;
    }

    .cw-mode-button.active {
      background: #c47b3a;
      color: #000;
    }

    .cw-main {
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .cw-grid-frame {
      position: relative;
      width: min(420px, 100%);
      aspect-ratio: 1 / 1;
      border: 2px solid #c47b3a;
      margin-bottom: 10px;
      overflow: hidden;
    }

    .cw-background {
      position: absolute;
      inset: 0;
      background-image: url("https://static.wixstatic.com/media/6d3632_8671621dade74457977217105254aadf~mv2.png");
      background-size: cover;
      background-position: center;
      opacity: 0.9;
      z-index: 1;
    }

    .cw-grid {
      position: absolute;
      inset: 0;
      display: grid;
      grid-template-columns: repeat(15, 1fr);
      grid-template-rows: repeat(15, 1fr);
      padding: 18px;
      z-index: 2;
    }

    .cw-cell {
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .cw-cell.has-letter::before {
      content: "";
      position: absolute;
      inset: 1px;
      border: 1px solid #c47b3a;
      background: rgba(0, 0, 0, 0.45);
    }

    .cw-number {
      position: absolute;
      top: 2px;
      left: 3px;
      font-size: 9px;
      color: #f5be80;
      z-index: 3;
      pointer-events: none;
    }

    .cw-input {
      position: relative;
      width: 100%;
      height: 100%;
      border: none;
      background: transparent;
      text-align: center;
      text-transform: uppercase;
      font-size: 14px;
      color: #fff;
      z-index: 4;
    }

    .cw-input:focus {
      outline: 1px solid #ffd08a;
      outline-offset: -1px;
    }

    .cw-buttons {
      display: flex;
      justify-content: center;
      gap: 8px;
      margin-bottom: 8px;
    }

    .cw-button {
      border: 1px solid #c47b3a;
      background: #000;
      color: #f5be80;
      padding: 4px 12px;
      font-size: 12px;
      cursor: pointer;
      border-radius: 3px;
    }

    .cw-button:hover {
      background: #c47b3a;
      color: #000;
    }

    .cw-message {
      text-align: center;
      font-size: 12px;
      margin-bottom: 8px;
      min-height: 18px;
    }

    .cw-message.ok {
      color: #8fd18f;
    }

    .cw-message.err {
      color: #ffb3b3;
    }

    .cw-clues-block {
      margin-top: 8px;
      font-size: 12px;
    }

    .cw-clues-block h3 {
      margin: 6px 0 4px;
      font-size: 12px;
    }

    .cw-clues-block ol {
      margin: 0 0 4px 18px;
      padding: 0;
    }

    .cw-clues-block li {
      margin-bottom: 2px;
    }

    @media (max-width: 480px) {
      .cw-wrapper {
        margin: 8px;
        padding: 12px 10px 16px;
      }

      .cw-grid-frame {
        width: 100%;
      }

      .cw-title {
        font-size: 16px;
      }

      .cw-input {
        font-size: 12px;
      }
    }
  </style>
</head>
<body>
  <div class="cw-wrapper">
    <div class="cw-title">Zertifikats-Kreuzworträtsel – Level 1</div>

    <div class="cw-mode-toggle">
      <button type="button" class="cw-mode-button active" data-mode="across">
        Waagrecht
      </button>
      <button type="button" class="cw-mode-button" data-mode="down">
        Senkrecht
      </button>
    </div>

    <div class="cw-main">
      <div class="cw-grid-frame">
        <div class="cw-background"></div>
        <div class="cw-grid" id="cw-grid"></div>
      </div>

      <div class="cw-buttons">
        <button type="button" class="cw-button" id="check-btn">Lösung prüfen</button>
        <button type="button" class="cw-button" id="clear-btn">Alles löschen</button>
      </div>

      <div class="cw-message" id="cw-message"></div>

      <div class="cw-clues-block">
        <h3>Waagrecht</h3>
        <ol id="across-clues"></ol>

        <h3>Senkrecht</h3>
        <ol id="down-clues"></ol>
      </div>
    </div>
  </div>

  <script>
    // -------------------------------------------------------------
    // 1. Wort-Eingabe (deine Daten)
    // -------------------------------------------------------------
    const WORDS_INPUT = [
      {
        answer: "ASTROLOGIE",
        clue: "Lehre von den Zusammenhängen zwischen Gestirnen und irdischen Ereignissen.",
        direction: "across",
      },
      {
        answer: "CHIRON",
        clue: "Planetoid, der oft mit Wunde und Heilung verbunden wird.",
        direction: "down",
      },
      {
        answer: "ASPEKT",
        clue: "Winkelbeziehung zwischen zwei Planeten.",
        direction: "across",
      },
      {
        answer: "STERNBILD",
        clue: "Worin stehen die Sternbilder in der Nacht?",
        direction: "down",
      },
    ];

    const GRID_SIZE = 15;

    // interne Strukturen
    const grid = Array.from({ length: GRID_SIZE }, () =>
      Array.from({ length: GRID_SIZE }, () => null)
    );

    const placedWords = []; // {answer, clue, direction, row, col, cells:[{r,c}]}
    const cellInputs = {}; // "r,c" -> input element
    const cellNumbers = {}; // "r,c" -> [nr1, nr2...]

    let activeWord = null;
    let activeIndex = 0;

    // -------------------------------------------------------------
    // 2. Hilfsfunktionen
    // -------------------------------------------------------------
    function key(r, c) {
      return r + "," + c;
    }

    function canPlaceWord(answer, direction, row, col) {
      const len = answer.length;
      if (direction === "across") {
        if (col + len > GRID_SIZE) return false;
      } else {
        if (row + len > GRID_SIZE) return false;
      }

      let hasOverlap = false;

      for (let i = 0; i < len; i++) {
        const r = direction === "across" ? row : row + i;
        const c = direction === "across" ? col + i : col;
        const existing = grid[r][c];
        if (existing) {
          if (existing.letter !== answer[i]) return false;
          hasOverlap = true;
        }
      }

      // zwingend: mindestens ein gemeinsamer Buchstabe
      if (!hasOverlap && placedWords.length > 0) return false;

      return true;
    }

    function placeWord(word) {
      const answer = word.answer;
      const dir = word.direction;
      const len = answer.length;

      // Versuche zuerst, einen gemeinsamen Buchstaben zu finden
      let bestPlacement = null;

      if (placedWords.length === 0) {
        // erstes Wort: mittig waagrecht
        const row = Math.floor(GRID_SIZE / 2);
        const col = Math.max(0, Math.floor((GRID_SIZE - len) / 2));
        if (canPlaceWord(answer, dir, row, col)) {
          bestPlacement = { row, col };
        }
      } else {
        outer: for (const placed of placedWords) {
          for (let i = 0; i < placed.answer.length; i++) {
            for (let j = 0; j < len; j++) {
              if (placed.answer[i] !== answer[j]) continue;

              const baseRow = placed.direction === "across"
                ? placed.row
                : placed.row + i;
              const baseCol = placed.direction === "across"
                ? placed.col + i
                : placed.col;

              let row, col;
              if (dir === "across") {
                row = baseRow;
                col = baseCol - j;
              } else {
                row = baseRow - j;
                col = baseCol;
              }

              if (
                row >= 0 &&
                col >= 0 &&
                row < GRID_SIZE &&
                col < GRID_SIZE &&
                canPlaceWord(answer, dir, row, col)
              ) {
                bestPlacement = { row, col };
                break outer;
              }
            }
          }
        }
      }

      if (!bestPlacement) {
        // wenn gar nichts geht und es das erste Wort ist, notfalls irgendwo hin
        if (placedWords.length === 0) {
          const row = Math.floor(GRID_SIZE / 2);
          const col = Math.max(0, Math.floor((GRID_SIZE - len) / 2));
          if (canPlaceWord(answer, dir, row, col)) {
            bestPlacement = { row, col };
          } else {
            return false;
          }
        } else {
          // bei späteren Wörtern lieber gar nicht platzieren, statt "in der Luft"
          return false;
        }
      }

      const cells = [];
      for (let i = 0; i < len; i++) {
        const r = dir === "across" ? bestPlacement.row : bestPlacement.row + i;
        const c = dir === "across" ? bestPlacement.col + i : bestPlacement.col;
        grid[r][c] = { letter: answer[i], wordIndex: placedWords.length };
        cells.push({ r, c });
      }

      placedWords.push({
        answer,
        clue: word.clue,
        direction: dir,
        row: bestPlacement.row,
        col: bestPlacement.col,
        cells,
        clueNumber: 0, // kommt später
      });

      return true;
    }

    function buildAllWords() {
      WORDS_INPUT.forEach((w) => placeWord(w));

      // Nummern für Clues (getrennt nach Richtung)
      let ac = 1;
      let dn = 1;
      for (const w of placedWords) {
        if (w.direction === "across") {
          w.clueNumber = ac++;
        } else {
          w.clueNumber = dn++;
        }
      }

      // Nummern pro Zelle sammeln (für 1/3 etc.)
      for (const w of placedWords) {
        const firstCell = w.cells[0];
        const k = key(firstCell.r, firstCell.c);
        if (!cellNumbers[k]) cellNumbers[k] = [];
        cellNumbers[k].push(w.clueNumber);
      }
    }

    // -------------------------------------------------------------
    // 3. Rendering
    // -------------------------------------------------------------
    function renderGrid() {
      const gridEl = document.getElementById("cw-grid");
      gridEl.innerHTML = "";

      for (let r = 0; r < GRID_SIZE; r++) {
        for (let c = 0; c < GRID_SIZE; c++) {
          const cell = document.createElement("div");
          cell.className = "cw-cell";

          const val = grid[r][c];
          if (val) {
            cell.classList.add("has-letter");

            const numKey = key(r, c);
            if (cellNumbers[numKey]) {
              const numEl = document.createElement("div");
              numEl.className = "cw-number";
              numEl.textContent = cellNumbers[numKey].join("/");
              cell.appendChild(numEl);
            }

            const input = document.createElement("input");
            input.maxLength = 1;
            input.className = "cw-input";
            input.dataset.row = r;
            input.dataset.col = c;
            cell.appendChild(input);
            cellInputs[numKey] = input;

            input.addEventListener("input", onCellInput);
            input.addEventListener("focus", onCellFocus);
          }

          gridEl.appendChild(cell);
        }
      }
    }

    function renderClues() {
      const acrossOl = document.getElementById("across-clues");
      const downOl = document.getElementById("down-clues");
      acrossOl.innerHTML = "";
      downOl.innerHTML = "";

      const acrossWords = placedWords.filter((w) => w.direction === "across");
      const downWords = placedWords.filter((w) => w.direction === "down");

      acrossWords.forEach((w) => {
        const li = document.createElement("li");
        li.textContent = w.clue;
        li.dataset.wordIndex = placedWords.indexOf(w);
        acrossOl.appendChild(li);
      });

      downWords.forEach((w) => {
        const li = document.createElement("li");
        li.textContent = w.clue;
        li.dataset.wordIndex = placedWords.indexOf(w);
        downOl.appendChild(li);
      });
    }

    // -------------------------------------------------------------
    // 4. Interaktion
    // -------------------------------------------------------------
    function setActiveWordByCell(row, col) {
      const k = key(row, col);
      const input = cellInputs[k];
      if (!input) return;

      for (const w of placedWords) {
        const idx = w.cells.findIndex((c) => c.r === row && c.c === col);
        if (idx !== -1) {
          activeWord = w;
          activeIndex = idx;
          break;
        }
      }
    }

    function moveToNextCell() {
      if (!activeWord) return;
      if (activeIndex < activeWord.cells.length - 1) {
        activeIndex++;
        const { r, c } = activeWord.cells[activeIndex];
        const inp = cellInputs[key(r, c)];
        if (inp) inp.focus();
      }
    }

    function onCellInput(e) {
      const inp = e.target;
      const val = (inp.value || "").toUpperCase();
      inp.value = val.slice(-1);
      const r = parseInt(inp.dataset.row, 10);
      const c = parseInt(inp.dataset.col, 10);
      setActiveWordByCell(r, c);
      moveToNextCell();
    }

    function onCellFocus(e) {
      const inp = e.target;
      const r = parseInt(inp.dataset.row, 10);
      const c = parseInt(inp.dataset.col, 10);
      setActiveWordByCell(r, c);
    }

    function clearAll() {
      Object.values(cellInputs).forEach((inp) => (inp.value = ""));
      showMessage("", "");
    }

    function showMessage(text, type) {
      const msgEl = document.getElementById("cw-message");
      msgEl.textContent = text;
      msgEl.classList.remove("ok", "err");
      if (type) msgEl.classList.add(type);
    }

    function checkSolution() {
      let allFilled = true;
      let allCorrect = true;

      for (const w of placedWords) {
        let wordFilled = true;
        let wordCorrect = true;

        w.cells.forEach((cell, idx) => {
          const inp = cellInputs[key(cell.r, cell.c)];
          const ch = (inp.value || "").toUpperCase();
          if (!ch) wordFilled = false;
          if (ch !== w.answer[idx]) wordCorrect = false;
        });

        if (!wordFilled) allFilled = false;
        if (!wordCorrect) allCorrect = false;
      }

      if (!allFilled) {
        showMessage("Es sind noch leere Felder vorhanden.", "err");
      } else if (!allCorrect) {
        showMessage("Einige Antworten sind noch falsch.", "err");
      } else {
        showMessage("Gratuliere! Alle Antworten sind korrekt.", "ok");
      }
    }

    function initModeButtons() {
      const buttons = document.querySelectorAll(".cw-mode-button");
      buttons.forEach((btn) => {
        btn.addEventListener("click", () => {
          buttons.forEach((b) => b.classList.remove("active"));
          btn.classList.add("active");
          // aktuell dient der Modus nur der Optik – die Eingabe funktioniert
          // unabhängig von der gewählten Richtung.
        });
      });
    }

    // -------------------------------------------------------------
    // 5. Start
    // -------------------------------------------------------------
    buildAllWords();
    renderGrid();
    renderClues();
    initModeButtons();

    document.getElementById("check-btn").addEventListener("click", checkSolution);
    document.getElementById("clear-btn").addEventListener("click", clearAll);
  </script>
</body>
</html>
